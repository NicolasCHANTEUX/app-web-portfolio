---
// Composant Dashboard - Affiche les stats du serveur en temps r√©el
---

<div class="dashboard-widget">
  <h2>üìä Dashboard Serveur</h2>
  
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-label">CPU</div>
      <div class="stat-value" id="cpuValue">--</div>
      <div class="stat-unit">%</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-label">RAM</div>
      <div class="stat-value" id="ramValue">--</div>
      <div class="stat-unit">%</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-label">Disque</div>
      <div class="stat-value" id="diskValue">--</div>
      <div class="stat-unit">%</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-label">üå°Ô∏è Temp</div>
      <div class="stat-value" id="temperatureValue">--</div>
      <div class="stat-unit"></div>
    </div>
    
    <div class="stat-card">
      <div class="stat-label">Uptime</div>
      <div class="stat-value" id="uptimeValue">--</div>
      <div class="stat-unit">j</div>
    </div>
  </div>
  
  <div class="docker-status" id="dockerStatus">
    <p>üê≥ Docker: <span id="dockerContainers">Chargement...</span></p>
  </div>
  
  <div class="last-update">
    Derni√®re mise √† jour: <span id="lastUpdate">--:--:--</span>
  </div>
</div>

<style>
  .dashboard-widget {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    padding: var(--spacing-md);
    box-shadow: var(--shadow-md);
  }
  
  .dashboard-widget h2 {
    margin-bottom: var(--spacing-md);
    color: var(--text-primary);
    font-size: 1.3rem;
  }
  
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-md);
  }
  
  .stat-card {
    background: var(--bg-accent);
    padding: var(--spacing-sm);
    border-radius: var(--radius-md);
    text-align: center;
    transition: transform var(--transition-fast);
  }
  
  .stat-card:hover {
    transform: translateY(-2px);
  }
  
  .stat-label {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin-bottom: var(--spacing-xs);
  }
  
  .stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--accent-color);
    font-family: 'Courier New', monospace;
  }
  
  .stat-unit {
    font-size: 0.875rem;
    color: var(--text-secondary);
  }
  
  .docker-status {
    background: var(--bg-accent);
    padding: var(--spacing-sm);
    border-radius: var(--radius-md);
    margin-bottom: var(--spacing-sm);
    font-family: 'Courier New', monospace;
  }
  
  .last-update {
    text-align: center;
    font-size: 0.75rem;
    color: var(--text-secondary);
  }
  
  .loading {
    opacity: 0.6;
  }
  
  /* Responsive mobile */
  @media (max-width: 768px) {
    .dashboard-widget {
      padding: var(--spacing-sm);
    }
    
    .dashboard-widget h3 {
      font-size: 1.2rem;
      margin-bottom: var(--spacing-sm);
    }
    
    .stats-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: var(--spacing-xs);
    }
    
    .stat-card {
      padding: var(--spacing-xs);
    }
    
    .stat-label {
      font-size: 0.75rem;
    }
    
    .stat-value {
      font-size: 1.5rem;
    }
    
    .stat-unit {
      font-size: 0.75rem;
    }
    
    .docker-status {
      padding: var(--spacing-xs);
      font-size: 0.85rem;
    }
    
    .last-update {
      font-size: 0.7rem;
    }
  }
</style>

<script>
  // Fonction pour mettre √† jour les stats
  async function updateDashboard() {
    try {
      // R√©cup√©rer les stats serveur
      const serverResponse = await fetch('/api/server/status');
      const serverData = await serverResponse.json();
      
      if (serverData.success) {
        const stats = serverData.data;
        
        // Mettre √† jour CPU
        const cpuEl = document.getElementById('cpuValue');
        if (cpuEl) cpuEl.textContent = stats.cpu?.percent != null ? String(stats.cpu.percent) : 'N/A';
        
        // Mettre √† jour RAM
        const ramEl = document.getElementById('ramValue');
        if (ramEl) ramEl.textContent = stats.memory?.percent != null ? String(stats.memory.percent) : 'N/A';
        
        // Mettre √† jour Disque
        const diskEl = document.getElementById('diskValue');
        if (diskEl) diskEl.textContent = stats.disk?.percent != null ? String(stats.disk.percent) : 'N/A';
        
        // Mettre √† jour Temp√©rature (peut √™tre null si conteneur sans acc√®s capteurs)
        const tempEl = document.getElementById('temperatureValue');
        if (tempEl) tempEl.textContent = stats.temperature?.celsius != null ? String(stats.temperature.celsius) + '¬∞C' : 'N/A';
        
        // Mettre √† jour Uptime
        const uptimeDays = Math.floor(stats.uptime.seconds / 86400);
        const uptimeEl = document.getElementById('uptimeValue');
        if (uptimeEl) uptimeEl.textContent = String(uptimeDays);
      }
      
      // R√©cup√©rer l'√©tat Docker
      const dockerResponse = await fetch('/api/server/docker');
      const dockerData = await dockerResponse.json();
      
      if (dockerData.success) {
        const { running, total } = dockerData.data;
        const dockerEl = document.getElementById('dockerContainers');
        if (dockerEl) dockerEl.textContent = `${running} actifs / ${total} total`;
      }
      
      // Mettre √† jour l'heure
      const now = new Date();
      const updateEl = document.getElementById('lastUpdate');
      if (updateEl) updateEl.textContent = now.toLocaleTimeString();
      
    } catch (error) {
      console.error('Erreur lors de la mise √† jour du dashboard:', error);
      const cpuEl = document.getElementById('cpuValue');
      const ramEl = document.getElementById('ramValue');
      const dockerEl = document.getElementById('dockerContainers');
      if (cpuEl) cpuEl.textContent = '??';
      if (ramEl) ramEl.textContent = '??';
      if (dockerEl) dockerEl.textContent = 'Erreur';
    }
  }
  
  // Mise √† jour initiale
  updateDashboard();
  
  // Mise √† jour toutes les 5 secondes
  setInterval(updateDashboard, 5000);
</script>
